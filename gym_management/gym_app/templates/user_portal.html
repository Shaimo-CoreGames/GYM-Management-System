{% extends 'base.html' %}
{% load static %}
{% block title %}User Portal{% endblock %}
{% block content %}
<style>
    body {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        background: url("{% static 'images/Loginback.jpg' %}")no-repeat center center fixed;
        color: #ffffff;
        background-size: 100%;
        line-height: 1.6;
    }

    .container {
        max-width: 1000px;
        /* keeps content from stretching too wide */
        margin: 0 auto;
        /* centers horizontally */
        text-align: center;
        /* centers text inside */
        padding: 20px;
    }

    h1,
    h2,
    h3 {
        /* width: 70%; */
        margin-top: 1.5rem;
        margin-bottom: 0.75rem;
        font-weight: 600;
        color: #dcb32c;
        /* border-width: 50px; */
        border: 2px solid #dcb32c;
        border-radius: 20px;

    }

    h1 {
        font-size: 2rem;
        text-align: center;
        color: #dcb32c;
    }



    form input {
        display: block;
        width: 100%;
        max-width: 400px;
        padding: 10px;
        margin: 8px 0;
        background: transparent;
        border: 1px solid #ccc;
        border-radius: 6px;
        font-size: 1rem;
        transition: border 0.3s;
    }

    form input:focus {
        border: 1px solid #dbdb0c;
        outline: none;
    }

    .btn {
        background: #dbdb0c;
        color: white;
        padding: 10px 18px;
        border: none;
        border-radius: 6px;
        font-size: 1rem;
        cursor: pointer;
        transition: 0.3s;
        margin-top: 10px;
    }

    .btn:hover {
        background: #e76119;
    }

    .plan-card {
        border: 1px solid #ddd;
        padding: 1.5rem;
        margin: 1.5rem 0;
        border-radius: 10px;
        background: transparent;
        box-shadow: 0 14px 12px rgba(198, 24, 24, 0.08);
        max-width: 900px;
    }

    .week-table {
        width: 100%;
        border-collapse: collapse;
        margin: 1rem 0;
        border-radius: 6px;
        overflow: hidden;
    }

    .week-table th,
    .week-table td {
        border: 1px solid #e0e0e0;
        padding: 0.85rem;
        text-align: left;
    }

    .week-table th {
        background: #dbdb0c;
        color: white;
        font-weight: 600;
    }

    .week-table tr:nth-child(even) {
        /* background: #f9f9f9; */
    }

    .week-table tr:hover {
        /* background: #eafaf1; */
    }

    .info-box,
    .warning-box {
        padding: 1rem 1.25rem;
        border-radius: 8px;
        margin: 1.2rem 0;
        font-size: 0.95rem;
    }

    .info-box {
        background: #e8f5e9;
        border-left: 5px solid #e29c32;
    }

    .warning-box {
        background: #fff3e0;
        border-left: 5px solid #ff9800;
    }

    p {
        display: block;
        align-items: center;
        justify-content: center;
        margin: 0.5rem 0;
        color: #ffffff;
        border-radius: 5px;
        margin-bottom: 30px;
        /* border: 1px solid #ffffff; */
        background: transparent;
        /* text-shadow: #e76119; */
    }
</style>
<div class="container">
    <h1>Welcome, {{ user.first_name }} {{ user.last_name }}</h1>

    {% if not user.is_approved %}
    <div class="warning-box">
        Admin is approving your payment. Within 24 hours this warning will be removed.
    </div>
    {% endif %}

    <h2>Personal Information</h2>
    <div
        style="border:2px solid #f1f0ed; text-color:#ccc; width:50%; padding: 15px; border-radius: 10px; display: inline-block; text-align: left;">
        <form method="POST" action="/update_user_info">
            {% csrf_token %}
            <input type="email" name="email" value="{{ user.email }}" placeholder="Email">
            <input type="text" name="phone_number" value="{{ user.phone_number }}" placeholder="Phone">
            <input type="number" name="weight" value="{{ user.weight }}" placeholder="Weight (kg)">
            <input type="number" name="height" value="{{ user.height }}" placeholder="Height (cm)">
            <button type="submit" class="btn">Update Info</button>
        </form>
    </div>
    {% if bmi %}
    <div class="info-box">
        <p><strong>BMI:</strong> {{ bmi }} - {{ bmi_status }}</p>
    </div>
    {% endif %}

    <h2>My Trainer</h2>
    {% if user.assigned_trainer %}
    <div class="info-box">
        <p><strong>Trainer:</strong> {{ user.assigned_trainer.first_name }} {{ user.assigned_trainer.last_name }}</p>
        {% if user.assigned_trainer.specialization %}
        <p><strong>Specialization:</strong> {{ user.assigned_trainer.specialization }}</p>
        {% endif %}
    </div>
    {% elif user.trainer_requested %}
    <p style="color: orange;">Trainer request pending...</p>
    {% else %}
    <a href="/request_trainer" class="btn">Get a Trainer</a>
    {% endif %}

    <h2>My Workout Plan</h2>
    {% if user.assigned_workout_plan %}
    <div class="plan-card">
        <h3>{{ user.assigned_workout_plan.name }} ({{ user.assigned_workout_plan.difficulty_level|capfirst }})</h3>
        <p>{{ user.assigned_workout_plan.description }}</p>

        <table class="week-table">
            <thead>
                <tr>
                    <th>Day</th>
                    <th>Exercises</th>
                </tr>
            </thead>
            <tbody>
                {% for day in user.assigned_workout_plan.workout_days.all %}
                <tr>
                    <td><strong>{{ day.day_name }}</strong></td>
                    <td style="white-space: pre-line;">{{ day.exercises }}</td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="2" style="text-align: center; color: #ffffff;">No workout schedule available</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% else %}
    <p>No workout plan assigned yet</p>
    {% endif %}

    <h2>My Diet Plan</h2>
    {% if user.assigned_diet_plan %}
    <div class="plan-card">
        <h3>{{ user.assigned_diet_plan.name }}{% if user.assigned_diet_plan.total_calories %} ({{
            user.assigned_diet_plan.total_calories }} cal/day){% endif %}</h3>
        <p>{{ user.assigned_diet_plan.description }}</p>

        <table class="week-table">
            <thead>
                <tr>
                    <th>Day</th>
                    <th>Breakfast</th>
                    <th>Lunch</th>
                    <th>Dinner</th>
                    <th>Snacks</th>
                </tr>
            </thead>
            <tbody>
                {% for day in user.assigned_diet_plan.diet_days.all %}
                <tr>
                    <td><strong>{{ day.day_name }}</strong></td>
                    <td>{{ day.breakfast }}</td>
                    <td>{{ day.lunch }}</td>
                    <td>{{ day.dinner }}</td>
                    <td>{{ day.snacks|default:"—" }}</td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="5" style="text-align: center; color: #ffffff;">No meal schedule available</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% else %}
    <p>No diet plan assigned yet</p>
    {% endif %}

    <h2>All Available Workout Plans</h2>
    {% for plan in all_workout_plans %}
    <div class="plan-card">
        <h3>{{ plan.name }} ({{ plan.difficulty_level|capfirst }})</h3>
        <p>{{ plan.description }}</p>
        <p><em>By: {{ plan.trainer.first_name }} {{ plan.trainer.last_name }}</em></p>

        <table class="week-table">
            <thead>
                <tr>
                    <th>Day</th>
                    <th>Exercises</th>
                </tr>
            </thead>
            <tbody>
                {% for day in plan.workout_days.all %}
                <tr>
                    <td><strong>{{ day.day_name }}</strong></td>
                    <td style="white-space: pre-line;">{{ day.exercises }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% empty %}
    <p style="color: #ffffff;">No workout plans available yet</p>
    {% endfor %}

    <h2>All Available Diet Plans</h2>
    {% for plan in all_diet_plans %}
    <div class="plan-card">
        <h3>{{ plan.name }}{% if plan.total_calories %} ({{ plan.total_calories }} cal/day){% endif %}</h3>
        <p>{{ plan.description }}</p>
        <p><em>By: {{ plan.trainer.first_name }} {{ plan.trainer.last_name }}</em></p>

        <table class="week-table">
            <thead>
                <tr>
                    <th>Day</th>
                    <th>Breakfast</th>
                    <th>Lunch</th>
                    <th>Dinner</th>
                    <th>Snacks</th>
                </tr>
            </thead>
            <tbody>
                {% for day in plan.diet_days.all %}
                <tr>
                    <td><strong>{{ day.day_name }}</strong></td>
                    <td>{{ day.breakfast }}</td>
                    <td>{{ day.lunch }}</td>
                    <td>{{ day.dinner }}</td>
                    <td>{{ day.snacks|default:"—" }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% empty %}
    <p style="color: #ffffff;">No diet plans available yet</p>
</div>
{% endfor %}
{% endblock %}