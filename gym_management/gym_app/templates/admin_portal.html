{% extends 'base.html' %}
{% block title %}Admin Portal{% endblock %}

{% block page_script %}
    document.body.classList.add('login-page');
{% endblock %}

{% block content %}
<div style="background: rgba(255, 255, 255, 0.3); backdrop-filter: blur(8px); -webkit-backdrop-filter: blur(8px); border-radius: 8px; padding: 2rem; box-shadow: 0 0 20px rgba(0, 0, 0, 0.2);">
    <h1 style="text-align: center; margin-bottom: 1.5rem;">Admin Portal</h1>
    <p style="text-align: center; font-size: 1.2rem; margin-bottom: 2rem;">Welcome, {{ admin.first_name }}</p>

    <div style="background: rgba(255, 255, 255, 0.5); padding: 1.5rem; border-radius: 8px; margin-bottom: 2rem; text-align: center;">
        <h2 style="color: #2196F3; margin-bottom: 0.5rem;">Total Revenue</h2>
        <p style="font-size: 2rem; font-weight: bold; color: #4CAF50;">{{ total_revenue }} PKR</p>
    </div>

    <h2 style="margin-bottom: 1rem; color: #333;">Pending Payment Approvals</h2>
<table>
    <tr>
        <th>Name</th>
        <th>Membership</th>
        <th>Payment Proof</th>
        <th>Actions</th>
    </tr>
    {% for user in pending_approvals %}
    <tr>
        <td>{{ user.first_name }} {{ user.last_name }}</td>
        <td>{{ user.membership_plan.name }}</td>
        <td><a href="{{ user.payment_proof.url }}" target="_blank">View</a></td>
        <td>
            <a href="/approve_payment/{{ user.id }}" class="btn">Approve</a>
            <a href="/reject_payment/{{ user.id }}" class="btn btn-danger">Reject</a>
        </td>
    </tr>
    {% endfor %}
</table>

<h2>Trainer Requests</h2>
<table>
    <tr>
        <th>Member</th>
        <th>Assign Trainer</th>
    </tr>
    {% for user in trainer_requests %}
    <tr>
        <td>{{ user.first_name }} {{ user.last_name }}</td>
        <td>
            <form method="POST" action="/assign_trainer_to_member" style="display: flex; gap: 10px; align-items: center;">
                {% csrf_token %}
                <input type="hidden" name="member_id" value="{{ user.id }}">
                <select name="trainer_id" required style="flex: 1;">
                    <option value="">Select Trainer</option>
                    {% for trainer in all_trainers %}
                    <option value="{{ trainer.id }}">{{ trainer.first_name }} {{ trainer.last_name }}</option>
                    {% endfor %}
                </select>
                <button type="submit" class="btn" style="white-space: nowrap;">Assign Trainer</button>
            </form>
        </td>
    </tr>
    {% endfor %}
</table>

<h2>Create New Trainer</h2>
<form method="POST" action="/create_trainer">
    {% csrf_token %}
    <input type="text" name="first_name" placeholder="First Name" required>
    <input type="text" name="last_name" placeholder="Last Name" required>
    <input type="email" name="email" placeholder="Email">
    <input type="text" name="phone_number" placeholder="Phone" required>
    <input type="text" name="username" placeholder="Username" required>
    <input type="password" name="password" placeholder="Password" required>
    <input type="text" name="specialization" placeholder="Specialization">
    <button type="submit" class="btn">Create Trainer</button>
</form>

<h2>All Members</h2>
<a href="/search_members" class="btn">Search Members</a>
<a href="/trainer_attendance" class="btn">Trainer Attendance</a>
<table>
    <tr>
        <th>Name</th>
        <th>Membership</th>
        <th>Trainer</th>
        <th>Actions</th>
    </tr>
    {% for member in all_members %}
    <tr>
        <td>{{ member.first_name }} {{ member.last_name }}</td>
        <td>{{ member.membership_plan.name }}</td>
        <td>{{ member.assigned_trainer.first_name|default:"None" }} {{ member.assigned_trainer.last_name|default:"" }}</td>
        <td><a href="/delete_member/{{ member.id }}" class="btn btn-danger" onclick="return confirm('Delete this member?')">Delete</a></td>
    </tr>
    {% endfor %}
</table>
{% endblock %}
